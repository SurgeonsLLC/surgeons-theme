{%- liquid
  capture button_1_text
    if section.settings.button_label_1 != blank
      echo section.settings.button_label_1
      else
        echo 'newsletter_popup.button' | t
    endif
  endcapture
  assign section_prefix_class = 'newsletter-popup'

  capture modal_heading
    echo 'newsletter_popup.heading' | t
  endcapture
-%}
<modal-component-popup
  data-modal="modal-newsletter-popup"
  data-trigger="delay"
  data-delay="200"
  data-storage="true"
  data-storage-key="newsletter_popup"
  data-storage-value="true"
  data-hide-outside="false"
>
  <div
    class="modal modal-component modal-component--newsletter-popup modal-component--{{ section.settings.age_position }} scheme--{{ section.settings.age_color_scheme }}"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modal-newsletter-popup-heading"
    aria-describedby="modal-newsletter-popup"
    tabindex="-1"
  >
    <div class="modal-component_spacer">
      <div class="modal-component_wrapper" id="modal-newsletter-popup">
        <div class="modal-component_body">
          <div class="modal-component_content">
            <modal-component-toggler
              data-storage="true"
              data-storage-key="newsletter_popup"
              data-storage-value="true"
            >
              <button
                type="button"
                data-expanded="true"
                data-toggle-attribute="false"
                data-modal-ref="modal-newsletter-popup"
                class="modal-component_btn-close button--icn button">
                <span class="button_icn-wrapper">
                  {%- render 'icons-data', width: 14, height: 14, use_icon: true, icon_reference: 'cross' -%}
                  <span class="visually-hidden">{{- 'accessibility.close' | t -}}</span>
                </span>
              </button>
            </modal-component-toggler>
            <div class="newsletter-popup --align-{{ section.settings.age_text_alignment }}">
              <strong id="modal-newsletter-popup-heading" style="background-color: white; color: black;" class="visually-hidden">
                {{- modal_heading -}}
              </strong>
              {%- for block in section.blocks -%}
                {%- case block.type -%}
                  {%- when 'heading' -%}
                    <strong class="{{ section_prefix_class }}_heading {{ block.settings.heading_weight }} {{ block.settings.heading_size }} {{ block.type }} mty" style="--block-spacing: {{ block.settings.block_spacing }}px;" {{ block.shopify_attributes }}>
                      {{- block.settings.heading -}}
                    </strong>
                  {%- when 'text' -%}
                    <div
                      class="newsletter-popup_description mty {{ block.settings.description_weight }} {{ block.settings.block_text_size_heading }}"
                      {{ block.shopify_attributes }}
                      style="--block-spacing: {{ block.settings.block_spacing }}px"
                    >
                      {{- block.settings.description -}}
                    </div>
                  {%- when 'form' -%}
                    <div
                      class="newsletter-popup_form mty"
                      {{ block.shopify_attributes }}
                      style="--block-spacing: {{ block.settings.block_spacing }}px"
                    >
                      {%- liquid
                        assign id = 'newsletter-popup-' | append: section.id
                        render 'newsletter-popup-form', prefix_class: 'newsletter-popup', form_id: id, button_label: button_1_text, section_id: section.id
                      -%}
                    </div>
                  {%- when 'countdown_timer' -%}
                    <div
                      class="newsletter-popup_countdown-timer mty"
                      {{ block.shopify_attributes }}
                      style="--block-spacing: {{ block.settings.block_spacing }}px"
                    >
                      {%- render 'countdown-timer', end_date: block.settings.end_date, end_type: block.settings.end_type, end_message: block.settings.end_message, align_center: false -%}
                    </div>
                  {%- when 'image' -%}
                    <div
                      class="newsletter-popup_image {% if block.settings.hide_image_on_mobile %}--mobile-hidden{% endif %} mty"
                      {{ block.shopify_attributes }}
                       style="--block-spacing: {{ block.settings.block_spacing }}px"
                    >
                        {%- if block.settings.image != blank -%}
                          {%- liquid
                            capture image_alt
                              if block.settings.image.alt != blank
                                echo block.settings.image.alt
                                else
                                  echo modal_heading | escape
                              endif
                            endcapture
                          -%}
                          {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: class: '', loading: 'lazy', widths: '3840, 480', sizes: '(max-width: 767px) 3840vw', alt: image_alt -}}
                          {%- else -%}
                            {{- 'image' | placeholder_svg_tag: 'object-fit' -}}
                        {%- endif -%}
                    </div>
                {%- endcase -%}
              {%- endfor -%}
              <a href="{{- routes.root_url -}}" class="visually-hidden">home</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</modal-component-popup>