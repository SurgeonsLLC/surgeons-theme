{%- comment -%}
  renders video card
  usage
    {%- render 'auto-play-video-card', card: card, prefix_class: section_prefix_class, index: forloop.index -%}
{%- endcomment -%}
{%- liquid
  capture video_id
    echo card.settings.upload_video.id | default: card.settings.video_url.id
  endcapture

  capture video_alt
    echo card.settings.default_text | default: card.settings.upload_video.alt
  endcapture

  assign poster = card.settings.cover_image | default: card.settings.upload_video.preview_image

  capture enable_loop_attr
    if card.settings.enable_video_looping
      echo '&loop=1&playlist=' | append: video_id
    endif
  endcapture

  capture title_alt
    if card.settings.alt_text != blank
      echo card.settings.alt_text
      else
        echo card.settings.default_text | default: card.settings.upload_video.alt
    endif
  endcapture

  capture button_text
    if card.settings.alt_text != blank
      echo card.settings.alt_text
      else
        if video_alt != blank
          echo video_alt
          else
            echo 'sections.video.video_alt_html' | t: caption: index
        endif 
    endif
  endcapture

  capture card_media_size
    if card_media_option == 'adapt'
      echo poster.aspect_ratio | default: '1'
      else
        echo '1'
    endif
  endcapture
-%}
<article class="auto-video-card --align-center {% if poster == blank %}--media-size--blank --media-size-{{ card_media_option }} {% else %}--media-size-{{ card_media_option }}{% endif %} {{ card_media_height }} {% if scheme_class != blank %}{{ scheme_class }}{% endif %}" style="--media-ratio: {{ card_media_size }};">
  {%- if card.settings.upload_video == blank -%}
    <div class="deferred-media__poster">
      {%- if poster != blank -%}
        {%- liquid
          capture image_alt
            if poster.alt != blank
              echo poster.alt
              else
                echo button_text | escape
            endif
          endcapture

          assign image_height = 286 | divided_by: poster.aspect_ratio | round
        -%}
        {{- poster | image_url: width: width_attr | image_tag:
          width: 286,
          height: image_height,
          class: 'object-fit object-fit--absolute',
          loading: loading_attr,
          widths: widths_attr,
          sizes: sizes_attr,
          alt: image_alt
        -}}
        {%- else -%}
          {%- render 'placeholder-svgs', type: 'hero', index: 1, class: 'object-fit object-fit--absolute' -%}
      {%- endif -%}
      {%- if heading != blank or description != blank -%}
        <div class="auto-video-card_content_overlay --q-align">
          {%- if heading != blank -%}
            <div class="auto-video-card_heading {{ heading_weight }} {{ heading_size }} --word-break mty">
              {{- heading -}}
            </div>
          {%- endif -%}
          {%- if description != blank -%}
            <div class="auto-video-card_description {{ description_size }} {{ description_weight }} --word-break mty">
              {{- description -}}
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>
  {%- endif -%} 
  {%- if card.settings.upload_video != blank -%}
    <deferred-media class="deferred-media auto-video-card_media" style="--media-ratio: {{ card_media_size }};" data-media-id="{{ section.id }}-{{ index }}-{{ video_id }}" {% if play_viewport %}data-play-viewport="true"{% endif %} {% if parent_id != blank %}data-parent='[data-deffered-parent="{{- parent_id -}}"]'{% endif %}>
      <button data-id="Deferred-Poster-Modal-{{ section.id }}-{{ index }}-{{ video_id }}" class="deferred-media__poster" type="button">
        {%- if poster != blank -%}
          {%- liquid
            capture image_alt
              if poster.alt != blank
                echo poster.alt
                else
                  echo button_text | escape
              endif
            endcapture

            assign image_height = 286 | divided_by: poster.aspect_ratio | round
          -%}
          {{- poster | image_url: width: width_attr | image_tag:
            width: 286,
            height: image_height,
            class: 'object-fit object-fit--absolute',
            loading: loading_attr,
            widths: widths_attr,
            sizes: sizes_attr,
            alt: image_alt
          -}}
          {%- else -%}
            {%- render 'placeholder-svgs', type: 'hero', index: 1, class: 'object-fit object-fit--absolute' -%}
        {%- endif -%}
        {%- if heading != blank or description != blank -%}
          <div class="auto-video-card_content_overlay --q-align">
            {%- if heading != blank -%}
              <div class="auto-video-card_heading {{ heading_weight }} {{ heading_size }} --word-break mty">
                {{- heading -}}
              </div>
            {%- endif -%}
            {%- if description != blank -%}
              <div class="auto-video-card_description {{ description_size }} {{ description_weight }} --word-break mty">
                {{- description -}}
              </div>
            {%- endif -%}
          </div>
        {%- endif -%}
      </button>
      <template>
        {%- if card.settings.upload_video != blank -%}
          {{- card.settings.upload_video | video_tag: image_size: width_attr, autoplay: true, preload: false, loop: true, controls: false, muted: true, class: 'object-fit object-fit--absolute' -}}
        {%- endif -%}
      </template>
    </deferred-media>
  {%- endif -%}
</article>